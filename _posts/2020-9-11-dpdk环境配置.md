```text
---
layout: post
title: Blogging Like a Hacker
---
```
# dpdk环境配置


1.

yum install svn
yum install gcc kernel-devel
yum install libpcap-devel

2.

- 确保系统是已安装linux kernel header，linux kernel版本号由系统本身决定，使用`uname -r`命令查看，kernel版本号必须大于2.6.33

- glibc版本号大于2.7

- libpcap函数库

- 查看kernel是否支持hugepages，如果出此CONFIG_HUGETLBFS=y，CONFIG_HUGETLB_PAGE=y则表示支持
  [root@localhost dpdk-17.08]# uname -r 
  3.10.0-229.el7.x86_64
  [root@localhost dpdk-17.08]# grep -i huge /boot/config-3.10.0-229.el7.x86_64 
  CONFIG_CGROUP_HUGETLB=y
  CONFIG_HAVE_ARCH_TRANSPARENT_HUGEPAGE=y
  CONFIG_TRANSPARENT_HUGEPAGE=y
  CONFIG_TRANSPARENT_HUGEPAGE_ALWAYS=y
  \#CONFIG_TRANSPARENT_HUGEPAGE_MADVISE is not set
  CONFIG_HUGETLBFS=y
  CONFIG_HUGETLB_PAGE=y

  3.

  修改/etc/default/grub启动文件：`vi /etc/default/grub` 
  [root@localhost ~]# vi /etc/default/grub 
  GRUB_TIMEOUT=5
  GRUB_DEFAULT=saved
  GRUB_DISABLE_SUBMENU=true
  GRUB_TERMINAL_OUTPUT="console" 
  GRUB_CMDLINE_LINUX="crashkernel=auto rhgb quiet net.ifnames=0 biosdevname=0" 
  GRUB_DISABLE_RECOVERY="true" 
  修改GRUB_CMDLINE_LINUX，增加如下内容
  default_hugepagesz=1G hugepagesz=1G hugepages=16 isolcpus=1-21,28-48 nohz_full=1-21,28-48 rcu_nocbs=1-21,28-48

  ！！！修改的内容要放到引号以内！！！

  其中末尾的cpu编号为需要隔离的核，使用lscpu中的NUMA node0 cpu(s)可以看到可以隔离的核，一般0号核不隔离。假如总可用为0-7，可以选择隔离1-4，剩下的用于系统自身备用

  default_hugepagesz=1G hugepagesz=1G hugepages=16配置16G大页内存
  isolcpus=1-21,28-48 nohz_full=1-21,28-48 rcu_nocbs=1-21,28-48代表隔离CPU

  然后运行 grub 更新并重启系统：
  `grub2-mkconfig -o /boot/grub2/grub.cfgreboot`

  ！！！一定要有done，不要提前执行下一步！！！

  4.hugepage挂载
  上一步执行的是大页内存的预留，为了能够将其有效的使用，还需要进行挂载。
  `mkdir /mnt/hugemount -t hugetlbfs nodev /mnt/huge`
  想要使得该挂载在系统每次启动时自动执行，将下列文本加入/etc/fstab里面去。
  `nodev /mnt/huge hugetlbfs defaults 0 0`
  对于1G的页面，页面大小必须在挂载时被显式指定
  `nodev /mnt/huge_1GB hugetlbfs pagesize=1G 0 0`

  配置完成后使用`grep -i huge /proc/meminfo`命令查看是否挂载成功

  [root@localhost dpdk-17.08]# grep -i huge /proc/meminfo
  AnonHugePages: 188416 kB
  HugePages_Total: 512
  HugePages_Free: 512
  HugePages_Rsvd: 0
  HugePages_Surp: 0
  Hugepagesize: 2048 kB

  其中，pages*size为大页内存大小
