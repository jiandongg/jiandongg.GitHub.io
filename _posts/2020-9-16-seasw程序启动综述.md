1. 分配cpu隔离

   目的：cpu隔离之后，程序可以独占cpu性能，同时提高cpu cache的命中率。

   分配方法：修改配置文件grub，见相关笔记。

   注意事项：对于多numa架构的机器，cpu隔离时尽量不要跨numa，使程序运行集中在一个numa中

2. 分配大页内存

   目的：大页内存使得程序可以独占内存，提高程序性能。

   分配方法：修改配置文件grub，见相关笔记。

   注意事项：大页内存的分配以2M或者1G为单位进行分配，分配时的参数可能有所不同，注意辨别。

   2.5 安装依赖包：`yum`，最好是联网，或者是使用光盘源。见相关笔记。

   `yum upgrade`

   `yum install libpcap-devel\kernel-devel\gcc\numactl-devel\gcc kernel-devel`

   万不得已，可以使用rpm安装，但有依赖不全的风险。

   2.6 拷贝源代码，善用svn，lsblk，mount，umount，eject命令

3. 编译DPDK

   进入dpdk文件夹

   `cd xxxx/dpdk`

   删除冗余文件

   `rm -rf x86_64........../`

   `make clean`

   设定环境变量

   `source dpdk.rc`（内部路径注意更新）

   配置并编译DPDK

   `make config T=x86_64-native-linuxapp-gcc && make`

   安装DPDK

   `make install T=x86_64-native-linuxapp-gcc`

   此时会在dpdk文件夹下产生新的x86_64-native-linuxapp-gcc文件夹，编译安装过程完成。随后开始绑定网卡（将网卡绑定给编译好的DPDK程序组建）

3. 绑定网卡

   目的：绑定网卡归DPDK所用

   分配方法：执行相关脚本命令，见相关笔记

   注意事项：执行脚本时注意目录切换，不要重复执行，重启则绑定的网卡失效

4. 编译lib

   进入lib文件夹

   `cd xxx/lib`

   清空，编译

   `make clean`

   `make`

5. 编译app

   进入app文件夹

   `cd xxx/app`

   清空，编译

   `make clean`

   `make`

6. 检查seasw.cli

   `/seasw1.0/app/seasw.cli`

   seasw.cli为配置文件，用来指导seasw的工作

   ```
   [root@localhost app]# vi seasw.cli 
   ;这个文档以;符号作为注释符
   mempool MEMPOOL0 buffer 2304 pool 512K cache 256 cpu 0
   mempool MEMPOOL1 buffer 2304 pool 512K cache 256 cpu 0
   ;内存分配，内存池信息
   
   swq SWQ size 1024 cpu 0
   ;swq为某种队列？
   ;protocol PROT0 mempool MEMPOOL1 pof 192.168.101.13 6643 dpid 3
   
   link LINK0 dev 0000:02:00.0 rxq 1 512 MEMPOOL0 txq 1 1024 promiscuous on
   link LINK1 dev 0000:02:00.1 rxq 1 512 MEMPOOL0 txq 1 1024 promiscuous on
   ;绑定的网卡，注意要将网卡的数量和设备号更改正确，使用dpdk脚本或lscpi |grep Ethernet查看
   ;本例中dpdk程序绑定了两张网卡，分别为LINK0和LINK1，设备号分别为0000:02:00.0、0000:02:00.1
   
   pipeline P0 period 5 offset_port_id 0 cpu 0 counter 100 iblock 65530
   
   pipeline P0 port in bsz 32 link LINK0 rxq 0
   pipeline P0 port in bsz 32 link LINK1 rxq 0
   pipeline P0 port in bsz 1 swq SWQ
   ;注意同步修改
   
   pipeline P0 port out bsz 1 link LINK0 txq 0
   pipeline P0 port out bsz 1 link LINK1 txq 0
   pipeline P0 port out bsz 1 swq SWQ
   ;注意同步修改
   
   pipeline P0 asm asm/ex.bin
   ;使用asm/ex.bin作为控制器流表的模拟配置文件
   
   ;pipeline P0 protocol PROT0
   "seasw.cli" 26L, 752C written
   ```

6. 根据seasw.cli配置文件所述，检查.asm文件，并生成ex.bin

   `seasw1.0/app/asm/`

   .asm为控制器流表配置文件，ex.bin为其生成的格式文件，使用asmpof生成

   `./seasw1.0/app/asm/asmpof xxxxx.asm ex.bin`

   outm.asm文件：

   ```
   [root@localhost app]# cat asm/outm.asm 
   	name example
   
   ;**************************************************************
   ;*  func: t1(em) match inport, ouput port 1                         
   ;**************************************************************
   
   ;**************************************************************
   ;*  packet                                                    *
   ;**************************************************************
   
   ; ETHernet header  offset(0)
   ;包结构分段
   	field	dst_mac = 1(0,48)
   	field	src_mac = 1(48,48)
   	field	type    = 1(96,16)
   	field	saddr = 1(208,32)	; source IP
   	field	daddr = 1(240,32)	; destination IP
   
   ;**************************************************************
   ;*  global metadata                                           *
   ;**************************************************************
   ;包的metadata，元数据
   	field	n_pkts = 3(0,32);
   
   ;**************************************************************
   ;*  Counter                                                   *
   ;**************************************************************
   ;计数器counter
   	counter cnt1, 1
   	counter cnt2, 2
   
   ;**************************************************************
   ;*  Table                                                     *
   ;**************************************************************
   ;流表，其中有一个entry1表项
   table	t1, 0, em, 8
   	match   type
   	entry   entry1
   endtable
   
   
   ;**************************************************************
   ;*  entry                                                     *
   ;**************************************************************
   ;表达对于匹配到type值为0x0800（掩码0x0000）的包，执行以下指令
   entry   entry1, 0, output
           priority	1
   		counter		0
           itime      	0
   	matchx          type, 0x0800, 0x0000 
   endentry	
   
   ;指令细节，outm代表出端口，sfd代表修改saddr为0x11111111
   proc	output, 0
   	outm	4
   	sfd 	saddr, 0x11111111
   	outm 	1
   	sfd 	saddr, 0x22222222
   	;outp 	1
   	tocp    1, 1500
   	exit
   endproc
   
   start	t1
   ```

7. 执行seasw主程序

`./build/app/seasw_fe -c 0x55 -- -s seasw.cli`

-c 0x55 为程序执行调用的cpu的十六进制掩码，1代表调用，0代表不调用

--为分隔符

-s seasw.cli 为程序引用的配置文件

执行后的打印，也表明了程序的工作流程，比如LINK个数，加载组建等等信息。

此后程序会进行正式的运行，并依照流表进行数据包转发工作
